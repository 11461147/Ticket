# Tixcraft æ¶ç¥¨æ©Ÿå™¨äºº - ç¨‹å¼æ¶æ§‹èªªæ˜

## ğŸ“ æª”æ¡ˆè³‡è¨Š

- **æª”æ¡ˆ**: `tixcraft.py`
- **ç¸½è¡Œæ•¸**: 980 è¡Œ
- **åŠŸèƒ½**: æ‹“å…ƒå”®ç¥¨ç¶²ç«™ (tixcraft.com) è‡ªå‹•æ¶ç¥¨æ©Ÿå™¨äºº
- **æŠ€è¡“æ£§**: Python + Tkinter (GUI) + Selenium (ç€è¦½å™¨è‡ªå‹•åŒ–) + ddddocr (é©—è­‰ç¢¼è¾¨è­˜)

---

## ğŸ—ï¸ ç¨‹å¼æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TixcraftGUI é¡åˆ¥                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åˆå§‹åŒ– (__init__)                                           â”‚
â”‚    â”œâ”€â”€ GUI å…ƒä»¶å»ºç«‹                                         â”‚
â”‚    â”œâ”€â”€ è¨­å®šæª”è¼‰å…¥                                           â”‚
â”‚    â””â”€â”€ ç‹€æ…‹è®Šæ•¸åˆå§‹åŒ–                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¨­å®šç®¡ç†                                                   â”‚
â”‚    â”œâ”€â”€ load_config()     è¼‰å…¥ JSON è¨­å®š                     â”‚
â”‚    â”œâ”€â”€ save_config()     å„²å­˜è¨­å®š                           â”‚
â”‚    â”œâ”€â”€ apply_config()    å¥—ç”¨è¨­å®šåˆ° GUI                     â”‚
â”‚    â””â”€â”€ on_config_change() è‡ªå‹•å„²å­˜                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¶ç¥¨æ§åˆ¶                                                   â”‚
â”‚    â”œâ”€â”€ toggle_ticketing()    é–‹å§‹/æš«åœåˆ‡æ›                  â”‚
â”‚    â”œâ”€â”€ start_ticketing()     å•Ÿå‹• Selenium                  â”‚
â”‚    â””â”€â”€ _wait_for_target_url() URL ç›£æ§                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ ¸å¿ƒæµç¨‹                                                   â”‚
â”‚    â”œâ”€â”€ _auto_ticketing()       å ´æ¬¡é¸æ“‡                     â”‚
â”‚    â”œâ”€â”€ _handle_seat_selection() åº§ä½é¸æ“‡ (ç´” JS)            â”‚
â”‚    â”œâ”€â”€ _confirm_selection()    ç¢ºèªé¸ä½                     â”‚
â”‚    â”œâ”€â”€ _handle_ticket_form()   å¡«å¯«è¡¨å–®                     â”‚
â”‚    â”œâ”€â”€ _handle_captcha()       é©—è­‰ç¢¼è™•ç†                   â”‚
â”‚    â””â”€â”€ _submit_form()          æäº¤è¡¨å–®                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯ç”±ç³»çµ±                                                   â”‚
â”‚    â”œâ”€â”€ _current_stage()      åˆ¤æ–·ç•¶å‰é é¢éšæ®µ               â”‚
â”‚    â”œâ”€â”€ _start_route_loop()   å•Ÿå‹•è·¯ç”±å¿ƒè·³                   â”‚
â”‚    â”œâ”€â”€ _stop_route_loop()    åœæ­¢è·¯ç”±å¿ƒè·³                   â”‚
â”‚    â””â”€â”€ _route_by_page()      ä¾é é¢è‡ªå‹•å°å‘                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ å…¨åŸŸå¸¸æ•¸è¨­å®š (ç¬¬ 15-47 è¡Œ)

### æ™‚é–“è¨­å®š

| å¸¸æ•¸ | å€¼ | ç”¨é€” |
|------|-----|------|
| `POLL_INTERVAL_MS` | 100ms | GUI è¼ªè©¢é–“éš” |
| `SEAT_POLL_INTERVAL_MS` | 100ms | é¸å€é è¼ªè©¢é–“éš” |
| `SLEEP_SHORT_SEC` | 0.1s | æœ€å°å»¶é²æ™‚é–“ |
| `AREA_REFRESH_INTERVAL_MS` | 2000ms | é¸å€é é‡æ•´é–“éš” |

### WebDriverWait è¶…æ™‚è¨­å®š

| å¸¸æ•¸ | å€¼ | ç”¨é€” |
|------|-----|------|
| `WAIT_LIST_ROWS` | 10s | å ´æ¬¡åˆ—è¡¨è¼‰å…¥ |
| `WAIT_AREA_PAGE` | 15s | é¸ä½é è¼‰å…¥ |
| `WAIT_AREA_LIST` | 10s | å€åŸŸåˆ—è¡¨é¡¯ç¤º |
| `WAIT_CONFIRM_BTN` | 10s | ç¢ºèªæŒ‰éˆ•å¯é» |
| `WAIT_FORM_PAGE` | 15s | è¡¨å–®é è¼‰å…¥ |
| `WAIT_SELECTS` | 5s | å¼µæ•¸ä¸‹æ‹‰è¼‰å…¥ |
| `WAIT_CHECKBOXES` | 5s | Checkbox è¼‰å…¥ |
| `WAIT_CAPTCHA_IMG` | 15s | é©—è­‰ç¢¼åœ–ç‰‡å‡ºç¾ |
| `WAIT_CAPTCHA_VISIBLE` | 10s | é©—è­‰ç¢¼åœ–ç‰‡å¯è¦‹ |
| `WAIT_CAPTCHA_READY` | 5s | é©—è­‰ç¢¼è¼‰å…¥å°±ç·’ |
| `WAIT_CAPTCHA_INPUT` | 10s | é©—è­‰ç¢¼è¼¸å…¥æ¡†å¯é» |
| `WAIT_POST_SUBMIT` | 1s | æäº¤å¾Œç‹€æ…‹è®ŠåŒ– |

### å…¶ä»–è¨­å®š

| å¸¸æ•¸ | å€¼ | ç”¨é€” |
|------|-----|------|
| `CAPTCHA_MAX_ATTEMPTS` | 2 | é©—è­‰ç¢¼æœ€å¤§å˜—è©¦æ¬¡æ•¸ |
| `CAPTCHA_LEN` | 4 | é©—è­‰ç¢¼é•·åº¦ |
| `REFRESH_ON_AREA` | True | é¸å€é è‡ªå‹•é‡æ•´é–‹é—œ |
| `ALLOWED_STAGES_AFTER_CAPTCHA` | `{'detail', 'game', 'area', 'captcha'}` | é©—è­‰ç¢¼é€å‡ºå¾Œç™½åå–®é é¢ |

---

## ğŸ¯ æ ¸å¿ƒæ¶ç¥¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¶ç¥¨æµç¨‹åœ–                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ä½¿ç”¨è€…é»æ“Šã€Œé–‹å§‹æ¶ç¥¨ã€                                          â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  toggle_ticketing() â”€â”€â†’ start_ticketing()                      â”‚
â”‚         â”‚                      â”‚                                â”‚
â”‚         â”‚                      â–¼                                â”‚
â”‚         â”‚              å•Ÿå‹• ChromeDriver                        â”‚
â”‚         â”‚              é–‹å•Ÿæ‹“å…ƒé¦–é                               â”‚
â”‚         â”‚                      â”‚                                â”‚
â”‚         â”‚                      â–¼                                â”‚
â”‚         â”‚         _wait_for_target_url()                       â”‚
â”‚         â”‚              (URL è®Šæ›´ç›£æ§)                           â”‚
â”‚         â”‚                      â”‚                                â”‚
â”‚         â–¼                      â–¼                                â”‚
â”‚  _start_route_loop() â†â”€â”€ _route_by_page()                      â”‚
â”‚    (æ¯ 100ms è¼ªè©¢)              â”‚                               â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                     â–¼                     â–¼                    â”‚
â”‚              stage='detail'        stage='game'                â”‚
â”‚              (è‡ªå‹•å°å‘ game)    _auto_ticketing()               â”‚
â”‚                     â”‚                     â”‚                    â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â–¼                               â”‚
â”‚                         stage='area'                           â”‚
â”‚                   _handle_seat_selection()                     â”‚
â”‚                        (ç´” JS å¿«é€Ÿé¸ä½)                         â”‚
â”‚                                â”‚                               â”‚
â”‚                                â–¼                               â”‚
â”‚                     _confirm_selection()                       â”‚
â”‚                         (ç¢ºèªé¸ä½)                              â”‚
â”‚                                â”‚                               â”‚
â”‚                                â–¼                               â”‚
â”‚                  stage='captcha' / 'form'                      â”‚
â”‚                    _handle_ticket_form()                       â”‚
â”‚                       (å¡«å¯«è³¼ç¥¨è¡¨å–®)                            â”‚
â”‚                                â”‚                               â”‚
â”‚                                â–¼                               â”‚
â”‚                      _handle_captcha()                         â”‚
â”‚                      (ddddocr é©—è­‰ç¢¼è¾¨è­˜)                       â”‚
â”‚                                â”‚                               â”‚
â”‚                                â–¼                               â”‚
â”‚                        _submit_form()                          â”‚
â”‚                         (æäº¤è¡¨å–®)                              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ æ–¹æ³•è©³ç´°èªªæ˜

### 1. åˆå§‹åŒ–èˆ‡è¨­å®š (ç¬¬ 49-156 è¡Œ)

#### `__init__(self, root)` (ç¬¬ 49-109 è¡Œ)
åˆå§‹åŒ– GUI èˆ‡ç‹€æ…‹è®Šæ•¸ï¼š
- å»ºç«‹ GUI å…ƒä»¶ï¼ˆç¶²å€è¼¸å…¥æ¡†ã€LOG å€ã€å ´æ¬¡è¼¸å…¥æ¡†ã€å¼µæ•¸è¼¸å…¥æ¡†ã€æŒ‰éˆ•ï¼‰
- è¼‰å…¥è¨­å®šæª”
- åˆå§‹åŒ–ç‹€æ…‹è®Šæ•¸ï¼š
  - `is_running`: æ¶ç¥¨åŸ·è¡Œç‹€æ…‹
  - `_route_timer`: è·¯ç”±å¿ƒè·³æ’ç¨‹
  - `_routing`: è·¯ç”±é‡å…¥ä¿è­·
  - `_after_captcha_submitted`: é©—è­‰ç¢¼é€å‡ºæ——æ¨™
  - `_ocr`: OCR ç‰©ä»¶ï¼ˆæ‡¶è¼‰å…¥ï¼‰

#### è¨­å®šç®¡ç†æ–¹æ³•

| æ–¹æ³• | è¡Œæ•¸ | åŠŸèƒ½ |
|------|------|------|
| `load_config()` | 111-127 | å¾ `tixcraft_config.json` è¼‰å…¥è¨­å®š |
| `save_config()` | 129-140 | å„²å­˜è¨­å®šè‡³ JSON |
| `apply_config()` | 142-145 | å°‡è¨­å®šå¥—ç”¨åˆ° GUI è¼¸å…¥æ¡† |
| `on_config_change()` | 147-148 | è¨­å®šè®Šæ›´æ™‚è‡ªå‹•å„²å­˜ |
| `on_closing()` | 150-156 | è¦–çª—é—œé–‰æ™‚æ¸…ç†è³‡æº |

---

### 2. æ¶ç¥¨æ§åˆ¶ (ç¬¬ 172-271 è¡Œ)

#### `toggle_ticketing()` (ç¬¬ 172-185 è¡Œ)
é–‹å§‹/æš«åœæ¶ç¥¨åˆ‡æ›ï¼š
- åˆ‡æ› `is_running` ç‹€æ…‹
- æ›´æ–°æŒ‰éˆ•æ–‡å­—
- å•Ÿå‹•/åœæ­¢è·¯ç”±å¿ƒè·³

#### `start_ticketing()` (ç¬¬ 187-220 è¡Œ)
å•Ÿå‹• Seleniumï¼š
- å»ºç«‹ ChromeOptionsï¼ˆåœç”¨è‡ªå‹•åŒ–åµæ¸¬ï¼‰
- ä½¿ç”¨ç¨ç«‹ user-data-dir é¿å…è¡çª
- é–‹å•Ÿæ‹“å…ƒé¦–é 
- å•Ÿå‹• URL ç›£æ§

#### `_wait_for_target_url()` (ç¬¬ 222-271 è¡Œ)
ç›£æ§ URL è®Šæ›´ï¼š
- åµæ¸¬ URL è®ŠåŒ–
- `detail` é è‡ªå‹•å°å‘ `game` é 
- ç¬¦åˆç›£æ§ç¶²å€æ™‚å•Ÿå‹•æ¶ç¥¨æµç¨‹

---

### 3. å ´æ¬¡é¸æ“‡ (ç¬¬ 273-318 è¡Œ)

#### `_auto_ticketing()` (ç¬¬ 273-318 è¡Œ)
è‡ªå‹•é¸æ“‡å ´æ¬¡ï¼š
```
æµç¨‹ï¼š
1. ç­‰å¾…å ´æ¬¡åˆ—è¡¨è¼‰å…¥ (tr.gridc.fcTxt)
2. éæ­·æ‰€æœ‰å ´æ¬¡
3. æª¢æŸ¥æŒ‰éˆ•æ˜¯å¦ enabled
4. ä¾é—œéµå­—åŒ¹é…æˆ–é¸ç¬¬ä¸€å€‹å¯è³¼ç¥¨å ´æ¬¡
5. JS é»æ“ŠæŒ‰éˆ•
6. å‘¼å« _handle_seat_selection()
```

---

### 4. åº§ä½é¸æ“‡ (ç¬¬ 320-454 è¡Œ)

#### `_handle_seat_selection()` (ç¬¬ 320-398 è¡Œ)
**ç´” JS å¿«é€Ÿé¸ä½**ï¼ˆæ ¸å¿ƒå„ªåŒ–ï¼‰ï¼š

```javascript
// JS é¸ä½é‚è¼¯ï¼ˆä¸€æ¬¡é€šè¨Šå®Œæˆï¼‰
(function(n) {
    const container = document.querySelector('div.zone.area-list');
    const links = container.querySelectorAll('li[class^="select_form_"] > a[id]');
    
    for (const a of links) {
        // å¯è¦‹æ€§æª¢æŸ¥
        if (!a.offsetParent) continue;
        if (getComputedStyle(a).pointerEvents === 'none') continue;
        if (a.classList.contains('disabled') || a.classList.contains('sold')) continue;
        
        // å‰©é¤˜æ•¸é‡æª¢æŸ¥ï¼šå‰©é¤˜ < è³¼ç¥¨æ•¸å‰‡è·³é
        const m = text.match(/å‰©é¤˜\s*(\d+)/);
        if (m && parseInt(m[1]) < n) continue;
        
        // èƒ½é»å°±é»
        a.click();
        return {found: true, ...};
    }
    return {found: false, ...};
})(n);
```

**æ•ˆèƒ½å„ªå‹¢**ï¼š
| é …ç›® | èˆŠç‰ˆ (Selenium) | æ–°ç‰ˆ (ç´” JS) |
|------|-----------------|--------------|
| é€šè¨Šæ¬¡æ•¸ | N Ã— 5+ æ¬¡ | 1 æ¬¡ |
| é¸ä½é€Ÿåº¦ | ~500ms-2s | ~10-50ms |

#### `_confirm_selection()` (ç¬¬ 400-454 è¡Œ)
ç¢ºèªé¸ä½ä¸¦é€²å…¥ä¸‹ä¸€æ­¥ï¼š
- ç­‰å¾…ç¢ºèªæŒ‰éˆ•è¼‰å…¥
- æª¢æŸ¥æŒ‰éˆ•æ–‡å­—å«ã€Œç¢ºèªã€ã€Œä¸‹ä¸€æ­¥ã€ç­‰
- JS é»æ“ŠæŒ‰éˆ•
- å‘¼å« `_handle_ticket_form()`

---

### 5. è¡¨å–®è™•ç† (ç¬¬ 456-524 è¡Œ)

#### `_handle_ticket_form()` (ç¬¬ 456-524 è¡Œ)
è™•ç†è³¼ç¥¨è¡¨å–®ï¼š
```
æµç¨‹ï¼š
1. ç­‰å¾…è¡¨å–®é è¼‰å…¥
2. è¨­å®šè³¼ç¥¨å¼µæ•¸ï¼ˆä¸‹æ‹‰é¸å–®ï¼‰
3. å‹¾é¸æ‰€æœ‰ checkboxï¼ˆåŒæ„æ¢æ¬¾ï¼‰
4. å‘¼å« _handle_captcha()
```

#### `_normalize_captcha()` (ç¬¬ 526-548 è¡Œ)
æ¨™æº–åŒ– OCR çµæœï¼š
- å»é™¤ç©ºç™½ï¼Œä¿ç•™è‹±æ•¸å­—
- é•·æ–¼ 4 ä½å–å‰ 4 ä½
- çŸ­æ–¼ 4 ä½ä»¥æœ€å¾Œå­—å…ƒè£œé½Š

---

### 6. é©—è­‰ç¢¼è™•ç† (ç¬¬ 566-795 è¡Œ)

#### `_on_captcha_form()` (ç¬¬ 566-580 è¡Œ)
åˆ¤æ–·æ˜¯å¦åœ¨é©—è­‰ç¢¼è¡¨å–®é ï¼š
- URL å« `/ticket/ticket/`
- æœ‰é©—è­‰ç¢¼åœ–ç‰‡æˆ–è¼¸å…¥æ¡†

#### `_handle_captcha()` (ç¬¬ 582-795 è¡Œ)
é©—è­‰ç¢¼è™•ç†æµç¨‹ï¼š
```
1. ç¢ºèªåœ¨é©—è­‰ç¢¼è¡¨å–®é 
2. ç­‰å¾…é©—è­‰ç¢¼åœ–ç‰‡è¼‰å…¥
3. Canvas æ“·å–åœ–ç‰‡ Base64
4. ddddocr OCR è¾¨è­˜
5. æ¨™æº–åŒ–çµæœï¼ˆ4ä½è‹±æ•¸å­—ï¼‰
6. å¡«å…¥è¼¸å…¥æ¡†
7. æäº¤è¡¨å–®
8. æª¢æŸ¥æ˜¯å¦æˆåŠŸï¼ˆæœ€å¤šé‡è©¦ 2 æ¬¡ï¼‰
```

---

### 7. è¡¨å–®æäº¤ (ç¬¬ 797-843 è¡Œ)

#### `_submit_form()` (ç¬¬ 797-843 è¡Œ)
æäº¤è³¼ç¥¨è¡¨å–®ï¼š
```
æŒ‰éˆ•æœå°‹é †åºï¼š
1. button.btn.btn-primary.btn-green
2. button[type="submit"].btn-green
3. input[type="submit"]
4. button[type="submit"]
5. input[value*="ç¢ºèª/æäº¤/ä¸‹ä¸€æ­¥"]
6. button[onclick*="submit"]
7. button.btn-green
```

---

### 8. è·¯ç”±ç³»çµ± (ç¬¬ 845-980 è¡Œ)

#### `_current_stage()` (ç¬¬ 845-870 è¡Œ)
åˆ¤æ–·ç•¶å‰é é¢éšæ®µï¼š

| URL ç‰¹å¾µ | å›å‚³å€¼ |
|----------|--------|
| `/activity/detail/` | `'detail'` |
| `/activity/game/` | `'game'` |
| `/ticket/area/` | `'area'` |
| `/ticket/ticket/` + é©—è­‰ç¢¼å…ƒç´  | `'captcha'` |
| `/ticket/ticket/` | `'form'` |
| å…¶ä»– | `'unknown'` |

#### `_start_route_loop()` (ç¬¬ 872-891 è¡Œ)
å•Ÿå‹•è·¯ç”±å¿ƒè·³ï¼š
- æ¯ 100ms åŸ·è¡Œ `_route_by_page()`
- æŒçºŒç›£æ§é é¢ç‹€æ…‹

#### `_stop_route_loop()` (ç¬¬ 893-900 è¡Œ)
åœæ­¢è·¯ç”±å¿ƒè·³

#### `_route_by_page()` (ç¬¬ 902-972 è¡Œ)
ä¾é é¢è‡ªå‹•å°å‘ï¼š

```
è·¯ç”±é‚è¼¯ï¼š
if stage == 'detail':
    â†’ è‡ªå‹•å°å‘ game é 
    
if stage == 'game':
    â†’ _auto_ticketing()
    
if stage == 'area':
    â†’ _handle_seat_selection()
    â†’ é¸ä½å¤±æ•—æ™‚è‡ªå‹•é‡æ•´
    
if stage == 'captcha':
    â†’ _handle_ticket_form()
    
if stage == 'form':
    â†’ _handle_ticket_form()
    
if stage == 'unknown':
    â†’ ç¹¼çºŒè¼ªè©¢
```

---

## ğŸ›¡ï¸ é˜²è­·æ©Ÿåˆ¶

| æ©Ÿåˆ¶ | èªªæ˜ |
|------|------|
| **é‡å…¥ä¿è­·** | `_routing` æ——æ¨™é˜²æ­¢è·¯ç”±é‡è¤‡åŸ·è¡Œ |
| **ç™½åå–®é™åˆ¶** | é©—è­‰ç¢¼é€å‡ºå¾Œåƒ…åœ¨ç‰¹å®šé é¢å‹•ä½œ |
| **è‡ªå‹•é‡è©¦** | é©—è­‰ç¢¼éŒ¯èª¤è‡ªå‹•é‡è©¦ï¼ˆæœ€å¤š 2 æ¬¡ï¼‰ |
| **è‡ªå‹•é‡æ•´** | é¸ä½ç„¡ç¥¨æ™‚è‡ªå‹•é‡æ•´é é¢ |
| **ç‹€æ…‹ç›£æ§** | æŒçºŒç›£æ§ URL è®ŠåŒ–ï¼Œè‡ªå‹•å°å‘æ­£ç¢ºæµç¨‹ |
| **éŒ¯èª¤è™•ç†** | å„éšæ®µçš†æœ‰ try-catchï¼ŒéŒ¯èª¤å¾Œå›åˆ°è·¯ç”±è¼ªè©¢ |

---

## ğŸ“¦ ä¾è³´å¥—ä»¶

```python
# æ¨™æº–åº«
import tkinter as tk
from tkinter import ttk, scrolledtext
import json
import os
import time
import base64
import tempfile

# ç¬¬ä¸‰æ–¹å¥—ä»¶
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from PIL import Image
import ddddocr
```

---

## âš™ï¸ è¨­å®šæª”æ ¼å¼

**æª”æ¡ˆ**: `tixcraft_config.json`

```json
{
  "url": "æ¶ç¥¨ç¶²å€",
  "session": "è³¼ç¥¨å ´æ¬¡é—œéµå­—",
  "ticket_count": "1"
}
```

---

## ğŸ® ä½¿ç”¨æµç¨‹

1. åŸ·è¡Œç¨‹å¼ï¼Œé–‹å•Ÿ GUI
2. è¼¸å…¥æ¶ç¥¨ç¶²å€ã€å ´æ¬¡é—œéµå­—ã€è³¼ç¥¨å¼µæ•¸
3. é»æ“Šã€Œé–‹å§‹æ¶ç¥¨ã€
4. ç¨‹å¼è‡ªå‹•é–‹å•Ÿ Chromeï¼Œä½¿ç”¨è€…æ‰‹å‹•ç™»å…¥æ‹“å…ƒå¸³è™Ÿ
5. é€²å…¥ç›®æ¨™é é¢å¾Œï¼Œç¨‹å¼è‡ªå‹•åŸ·è¡Œï¼š
   - **é¸æ“‡å ´æ¬¡** â†’ **é¸æ“‡åº§ä½** â†’ **å¡«å¯«è¡¨å–®** â†’ **è¾¨è­˜é©—è­‰ç¢¼** â†’ **æäº¤**

---

## ğŸ“ ç‰ˆæœ¬ç‰¹é»

- **ç´” JS é¸ä½**ï¼šæ¸›å°‘ Selenium é€šè¨Šæ¬¡æ•¸ï¼Œé¸ä½é€Ÿåº¦æå‡ 10-50 å€
- **å‰©é¤˜æ•¸é‡ç¯©é¸**ï¼šè‡ªå‹•è·³éå‰©é¤˜æ•¸é‡ä¸è¶³çš„å€åŸŸ
- **è·¯ç”±ç³»çµ±**ï¼šçµ±ä¸€ç®¡ç†é é¢å°å‘ï¼Œç¨‹å¼ç¢¼æ›´æ¸…æ™°
- **è‡ªå‹•é‡æ•´**ï¼šé¸ä½å¤±æ•—æ™‚è‡ªå‹•é‡æ•´é é¢
- **æ‡¶è¼‰å…¥ OCR**ï¼šé¿å…æ¯æ¬¡å˜—è©¦éƒ½æ–°å»º OCR ç‰©ä»¶